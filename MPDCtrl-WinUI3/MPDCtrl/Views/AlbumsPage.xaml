<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MPDCtrl.Views.AlbumsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MPDCtrl.Views"
    xmlns:mod="using:MPDCtrl.Models"
    xmlns:vm="using:MPDCtrl.ViewModels"
    xmlns:helper="using:MPDCtrl.Helpers"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:animations="using:CommunityToolkit.WinUI.Animations"
    xmlns:triggers="using:CommunityToolkit.WinUI"
    d:DataContext="{d:DesignInstance Type=vm:MainViewModel}"
    mc:Ignorable="d"
    NavigationCacheMode="Required">
    <Page.Resources>
        <animations:ImplicitAnimationSet x:Name="ShowTransitions">
            <animations:OffsetAnimation EasingMode="EaseOut" From="0,24,0" To="0" Duration="0:0:0.4" />
            <animations:OpacityAnimation EasingMode="EaseOut" From="0" To="1" Duration="0:0:0.2" />
        </animations:ImplicitAnimationSet>
        <animations:ImplicitAnimationSet x:Name="HideTransitions">
            <animations:OffsetAnimation EasingMode="EaseOut" From="0" To="0,24,0" Duration="0:0:0.2" />
            <animations:OpacityAnimation EasingMode="EaseOut" From="1" To="0" Duration="0:0:0.1" />
        </animations:ImplicitAnimationSet>
    </Page.Resources>
    <Grid x:Name="ContentGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="118"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" x:Name="HeaderGrid" Margin="24,0,24,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Page title -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" x:Uid="PageTitle_Albums" FontSize="{StaticResource FontSizePageTitle}" FontWeight="SemiBold"/>
                <TextBlock Grid.Column="1" FontSize="{StaticResource FontSizePageSubTitle}" Text="{x:Bind ViewModel.AlbumPageSubTitleAlbumCount, Mode=OneWay}" VerticalAlignment="Bottom" Padding="48,0,0,4" Opacity="0.7"/>
            </Grid>

            <!-- Page controls -->
            <Grid Grid.Row="1" Margin="0,24,0,14">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!--  buttons -->
                <StackPanel Grid.Column="0" Orientation="Horizontal">

                </StackPanel>

                <!-- Sort-->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">

                    <!-- Sort -->
                    <Button Height="36" Width="38" Margin="4,0,0,0">
                        <StackPanel Orientation="Horizontal">
                            <Viewbox Width="14" Height="14" Margin="0,0,6,0">
                                <PathIcon Width="NaN" Height="NaN" Margin="0" Data="M4.85355 2.14645C4.65829 1.95118 4.34171 1.95118 4.14645 2.14645L1.14645 5.14645C0.951184 5.34171 0.951184 5.65829 1.14645 5.85355C1.34171 6.04882 1.65829 6.04882 1.85355 5.85355L4 3.70711V13.5C4 13.7761 4.22386 14 4.5 14C4.77614 14 5 13.7761 5 13.5V3.70711L7.14645 5.85355C7.34171 6.04882 7.65829 6.04882 7.85355 5.85355C8.04882 5.65829 8.04882 5.34171 7.85355 5.14645L4.85355 2.14645ZM11.1525 13.8595C11.3463 14.0468 11.6537 14.0468 11.8475 13.8595L14.8475 10.9594C15.0461 10.7675 15.0514 10.4509 14.8595 10.2524C14.6676 10.0538 14.351 10.0485 14.1525 10.2404L12 12.3212L12 2.5001C12 2.22395 11.7761 2.0001 11.5 2.0001C11.2239 2.0001 11 2.22395 11 2.5001L11 12.3212L8.84752 10.2404C8.64898 10.0485 8.33244 10.0538 8.14051 10.2524C7.94858 10.4509 7.95394 10.7675 8.15248 10.9594L11.1525 13.8595Z"/>
                            </Viewbox>
                            <TextBlock x:Uid="PageMenu_Sort" Margin="8,0,6,0" FontSize="{StaticResource FontSizePageMenuControlText}" VerticalAlignment="Center" Visibility="Collapsed"/>
                        </StackPanel>
                        <Button.Flyout>
                            <MenuFlyout Placement="Bottom">
                                <MenuFlyoutItem x:Uid="ListviewColumnHeader_Album" Command="{x:Bind ViewModel.AlbumsSortByCommand}" CommandParameter="{Binding  Path=Tag, RelativeSource={RelativeSource Self}}" Tag="album" />
                                <MenuFlyoutItem x:Uid="ListviewColumnHeader_Artist" Command="{x:Bind ViewModel.AlbumsSortByCommand}" CommandParameter="{Binding  Path=Tag, RelativeSource={RelativeSource Self}}" Tag="artist" />
                                <MenuFlyoutSeparator/>
                                <MenuFlyoutItem x:Uid="PageMenu_ReverseSort" Command="{x:Bind ViewModel.AlbumsSortByCommand}" CommandParameter="{Binding  Path=Tag, RelativeSource={RelativeSource Self}}" Tag="reverse" />
                            </MenuFlyout>
                        </Button.Flyout>
                    </Button>
                </StackPanel>
            </Grid>

        </Grid>

        <Grid Grid.Row="1" x:Name="BodyGrid" Margin="24,0,0,0">
            <ListView x:Name="AlbumListView" ItemsSource="{x:Bind ViewModel.Albums, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedAlbum, Mode=TwoWay}" helper:ListViewBehavior.VisibleItems="{x:Bind ViewModel.VisibleItemsAlbumsEx, Mode=TwoWay}" SelectionMode="Single" ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                        IsMultiSelectCheckBoxEnabled="False">
                <ListView.Resources>
                    <x:Boolean x:Key="ListViewItemSelectionIndicatorVisualEnabled">False</x:Boolean>
                </ListView.Resources>
                <ListView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsWrapGrid Orientation="Horizontal"></ItemsWrapGrid>
                        <!-- No virtualization
                            <controls:UniformGrid Orientation="Horizontal" ColumnSpacing="24" RowSpacing="24"/>
                            -->
                    </ItemsPanelTemplate>
                </ListView.ItemsPanel>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="mod:AlbumEx">
                        <Grid Width="210" Height="226">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="184"/>
                                <RowDefinition Height="42"/>
                            </Grid.RowDefinitions>
                            <Border Grid.Row="0" x:Name="AlbumCoverBackground" CornerRadius="6" Width="184" Height="184" VerticalAlignment="Top" Background="{ThemeResource SmokeFillColorDefaultBrush}" Opacity="0.1">
                                <Path Stretch="UniformToFill" Fill="{ThemeResource TextFillColorSecondaryBrush}" Opacity="0.6" Width="100" Height="100" Data="M12 15.5q1.471 0 2.486-1.014Q15.5 13.47 15.5 12t-1.014-2.485T12 8.5T9.515 9.515T8.5 12t1.015 2.486T12 15.5m0-2.5q-.425 0-.712-.288T11 12t.288-.712T12 11t.713.288T13 12t-.288.713T12 13m.003 8q-1.867 0-3.51-.708q-1.643-.709-2.859-1.924t-1.925-2.856T3 12.003t.709-3.51Q4.417 6.85 5.63 5.634t2.857-1.925T11.997 3t3.51.709q1.643.708 2.859 1.922t1.925 2.857t.709 3.509t-.708 3.51t-1.924 2.859t-2.856 1.925t-3.509.709M12 20q3.35 0 5.675-2.325T20 12t-2.325-5.675T12 4T6.325 6.325T4 12t2.325 5.675T12 20m0-8"/>
                            </Border>
                            <Border Grid.Row="0" x:Name="AlbumCover" CornerRadius="6" Width="184" Height="184" VerticalAlignment="Top" Background="{ThemeResource LayerFillColorAltBrush}" PointerEntered="Border_PointerEntered" PointerExited="Border_PointerExited">
                                <Image Stretch="UniformToFill" Source="{x:Bind AlbumImage, Mode=OneWay}" Width="184" Height="184"/>
                            </Border>
                            <StackPanel Grid.Row="1">
                                <TextBlock Text="{x:Bind Name, Mode=OneWay}" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" Margin="16,6,16,0"/>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="{x:Bind AlbumArtist, Mode=OneWay}" Opacity="0.6" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" Margin="16,0,16,0" Visibility="{x:Bind AlbumArtist, Mode=OneWay, Converter={StaticResource StringVisibilityConverter}, ConverterParameter=False}"/>
                                    <TextBlock x:Uid="Text_UnknownArtist" Visibility="{x:Bind AlbumArtist, Mode=OneWay, Converter={StaticResource StringVisibilityConverter}, ConverterParameter=True}" Opacity="0.6" TextWrapping="NoWrap" TextTrimming="CharacterEllipsis" Margin="16,0,16,0"/>
                                </StackPanel>
                            </StackPanel>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
                <ListView.ItemContainerStyle>
                    <Style BasedOn="{StaticResource DefaultListViewItemStyle}" TargetType="ListViewItem">
                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                        <Setter Property="VerticalAlignment" Value="Top" />
                        <Setter Property="Height" Value="260" />
                        <Setter Property="Width" Value="230" />
                        <Setter Property="Padding" Value="10,10,10,0" />
                        <Setter Property="Margin" Value="6,6,6,6" />
                    </Style>
                </ListView.ItemContainerStyle>
            </ListView>
        </Grid>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1008" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HeaderGrid.Margin" Value="48,0,48,0" />
                        <Setter Target="BodyGrid.Margin" Value="20,0,0,0" />
                        <Setter Target="AlbumListView.Padding" Value="0,0,12,0" />
                        <Setter Target="AlbumListView.Margin" Value="0,24,0,0" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="640" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HeaderGrid.Margin" Value="24,0,24,0" />
                        <Setter Target="BodyGrid.Margin" Value="0,0,0,0" />
                        <Setter Target="AlbumListView.Padding" Value="0,0,12,0" />
                        <Setter Target="AlbumListView.Margin" Value="0,24,0,0" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="340" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HeaderGrid.Margin" Value="16,0,16,0" />
                        <Setter Target="BodyGrid.Margin" Value="0,0,0,0" />
                        <Setter Target="AlbumListview.Padding" Value="0,0,12,0" />
                        <Setter Target="AlbumListView.Margin" Value="0,24,0,0" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HeaderGrid.Margin" Value="16,0,16,0" />
                        <Setter Target="BodyGrid.Margin" Value="0,0,0,0" />
                        <Setter Target="AlbumListview.Padding" Value="0,0,12,0" />
                        <Setter Target="AlbumListView.Margin" Value="0,24,0,0" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</Page>
