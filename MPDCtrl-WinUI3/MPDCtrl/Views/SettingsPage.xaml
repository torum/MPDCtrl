<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="MPDCtrl.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:MPDCtrl.Views"
    xmlns:controls="using:CommunityToolkit.WinUI.Controls"
    xmlns:ui="using:CommunityToolkit.WinUI"
    xmlns:xaml="using:Microsoft.UI.Xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
    xmlns:vm="using:MPDCtrl.ViewModels" 
    xmlns:mod="using:MPDCtrl.Models" 
    d:DataContext="{d:DesignInstance Type=vm:MainViewModel}"
    mc:Ignorable="d"
    NavigationCacheMode="Required">

    <Grid x:Name="ContentGrid">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" x:Name="HeaderGrid" Margin="24,0,24,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- Page title -->
            <Grid Grid.Row="0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <TextBlock Grid.Column="0" x:Uid="PageTitle_Settings" FontSize="{StaticResource FontSizePageTitle}" FontWeight="SemiBold"/>
                <TextBlock Grid.Column="1" FontSize="{StaticResource FontSizePageSubTitle}" Text="{x:Bind ViewModel.VersionText, Mode=OneWay}" VerticalAlignment="Bottom" Padding="48,0,0,4" Opacity="0.7"/>
            </Grid>
        </Grid>

        <Grid Grid.Row="1" x:Name="BodyGrid" Margin="24,0,0,0">
            <ScrollViewer Margin="0,24,0,0">
                <StackPanel Spacing="24" Padding="0,0,0,24">

                    <!-- Themes -->
                    <controls:SettingsExpander x:Name="SettingsCardTheme"
                            VerticalAlignment="Top"
                            x:Uid="Settings_VisualPreferences"
                            IsEnabled="True"
                            IsExpanded="False">
                        <controls:SettingsExpander.HeaderIcon>
                            <PathIcon Width="NaN" Height="NaN" Margin="0" Data="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10Zm0-2V4a8 8 0 1 1 0 16Z"/>
                        </controls:SettingsExpander.HeaderIcon>

                        <controls:SettingsExpander.Items>

                            <controls:SettingsCard x:Uid="Settings_Theme" HorizontalContentAlignment="Left" ContentAlignment="Vertical" Description="">
                                <StackPanel Orientation="Horizontal" Spacing="24" Margin="0,6,0,12">

                                    <RadioButton x:Uid="Settings_Theme_Light" IsEnabled="{x:Bind ViewModel.IsBackdropEnabled, Mode=OneWay}" Command="{x:Bind ViewModel.SwitchThemeCommand}" IsChecked="{x:Bind ViewModel.Theme, Converter={StaticResource ElementThemeEnumToBooleanConverter}, ConverterParameter=Light, Mode=OneWay}" FontSize="15" GroupName="AppTheme">
                                        <RadioButton.CommandParameter>
                                            <xaml:ElementTheme>Light</xaml:ElementTheme>
                                        </RadioButton.CommandParameter>
                                    </RadioButton>
                                    <RadioButton x:Uid="Settings_Theme_Dark" IsEnabled="{x:Bind ViewModel.IsBackdropEnabled, Mode=OneWay}" Command="{x:Bind ViewModel.SwitchThemeCommand}" IsChecked="{x:Bind ViewModel.Theme, Converter={StaticResource ElementThemeEnumToBooleanConverter}, ConverterParameter=Dark, Mode=OneWay}" FontSize="15" GroupName="AppTheme">
                                        <RadioButton.CommandParameter>
                                            <xaml:ElementTheme>Dark</xaml:ElementTheme>
                                        </RadioButton.CommandParameter>
                                    </RadioButton>
                                    <RadioButton x:Uid="Settings_Theme_Default" IsEnabled="True" Command="{x:Bind ViewModel.SwitchThemeCommand}" IsChecked="{x:Bind ViewModel.Theme, Converter={StaticResource ElementThemeEnumToBooleanConverter}, ConverterParameter=Default, Mode=OneWay}" FontSize="15" GroupName="AppTheme">
                                        <RadioButton.CommandParameter>
                                            <xaml:ElementTheme>Default</xaml:ElementTheme>
                                        </RadioButton.CommandParameter>
                                    </RadioButton>
                                </StackPanel>
                            </controls:SettingsCard>

                            <controls:SettingsCard x:Uid="Settings_SystemBackdrop" HorizontalContentAlignment="Left" ContentAlignment="Vertical" Description="">

                                <StackPanel Orientation="Horizontal" Spacing="24" Margin="0,6,0,12">

                                    <RadioButton x:Uid="Settings_SystemBackdrop_Acrylic" IsEnabled="{x:Bind ViewModel.IsAcrylicSupported,Mode=OneWay}" Command="{x:Bind ViewModel.SwitchSystemBackdropCommand}" CommandParameter="Acrylic" IsChecked="{x:Bind ViewModel.Material, Converter={StaticResource SystemBackdropEnumToBooleanConverter}, ConverterParameter=Acrylic, Mode=OneWay}" FontSize="15" GroupName="AppMaterial"/>
                                    <RadioButton x:Uid="Settings_SystemBackdrop_Mica" IsEnabled="{x:Bind ViewModel.IsMicaSupported,Mode=OneWay}" Command="{x:Bind ViewModel.SwitchSystemBackdropCommand}" CommandParameter="Mica" IsChecked="{x:Bind ViewModel.Material, Converter={StaticResource SystemBackdropEnumToBooleanConverter}, ConverterParameter=Mica, Mode=OneWay}" FontSize="15" GroupName="AppMaterial"/>
                                    <RadioButton x:Uid="Settings_SystemBackdrop_MicaAlt" IsEnabled="{x:Bind ViewModel.IsMicaSupported,Mode=OneWay}" Command="{x:Bind ViewModel.SwitchSystemBackdropCommand}" CommandParameter="MicaAlt" IsChecked="{x:Bind ViewModel.Material, Converter={StaticResource SystemBackdropEnumToBooleanConverter}, ConverterParameter=MicaAlt, Mode=OneWay}" FontSize="15" GroupName="AppMaterial"/>
                                    <RadioButton x:Uid="Settings_SystemBackdrop_None" IsEnabled="True" Command="{x:Bind ViewModel.SwitchSystemBackdropCommand}" CommandParameter="None" IsChecked="{x:Bind ViewModel.Material, Converter={StaticResource SystemBackdropEnumToBooleanConverter}, ConverterParameter=None, Mode=OneWay}" FontSize="15" GroupName="AppMaterial"/>

                                </StackPanel>
                            </controls:SettingsCard>
                        </controls:SettingsExpander.Items>

                    </controls:SettingsExpander>

                    <!-- MPD -->
                    <controls:SettingsExpander x:Name="SettingsCardMPD"
                            VerticalAlignment="Top"
                            x:Uid="Settings_MPD"
                            IsEnabled="True"
                            IsExpanded="False">
                        
                        <TextBlock Text="{x:Bind ViewModel.ShortStatusWithMpdVersion, Mode=OneWay}"></TextBlock>
                        
                        <controls:SettingsExpander.Items>
                            <controls:SettingsCard Header="" Description="" HorizontalContentAlignment="Stretch" ContentAlignment="Vertical">

                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                                        <ColumnDefinition Width="*"></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel Grid.Column="0" Spacing="12" Margin="0,12,0,12" Orientation="Horizontal" HorizontalAlignment="Left">

                                        <ComboBox PlaceholderText="" MinWidth="300" Margin="0,0,0,0" SelectedIndex="-1" VerticalAlignment="Center"
                                           ItemsSource="{x:Bind ViewModel.Profiles, Mode=OneWay}" SelectedItem="{x:Bind ViewModel.SelectedProfile, Mode=TwoWay}">
                                            <ComboBox.ItemTemplate>
                                                <DataTemplate x:DataType="mod:Profile">
                                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                                        <Viewbox Width="12" Height="12" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,2,0,0">
                                                            <PathIcon Width="NaN" Height="NaN" Data="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z" Visibility="{x:Bind IsDefault, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"></PathIcon>
                                                        </Viewbox>
                                                        <TextBlock Text="{x:Bind Name, Mode=OneWay}" Margin="12,0,0,0" VerticalAlignment="Center"></TextBlock>
                                                    </StackPanel>
                                                </DataTemplate>
                                            </ComboBox.ItemTemplate>
                                        </ComboBox>

                                        <Button Command="{x:Bind ViewModel.ShowProfileAddDialogCommand}" HorizontalAlignment="Center" VerticalAlignment="Center" Width="39" Height="36" Margin="0,12,0,12">
                                            <Viewbox Width="14" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,2,0,0">
                                                <PathIcon Width="NaN" Height="NaN" Data="M11.883 3.007 12 3a1 1 0 0 1 .993.883L13 4v7h7a1 1 0 0 1 .993.883L21 12a1 1 0 0 1-.883.993L20 13h-7v7a1 1 0 0 1-.883.993L12 21a1 1 0 0 1-.993-.883L11 20v-7H4a1 1 0 0 1-.993-.883L3 12a1 1 0 0 1 .883-.993L4 11h7V4a1 1 0 0 1 .883-.993L12 3l-.117.007Z"></PathIcon>
                                            </Viewbox>
                                        </Button>

                                        <Button Command="{x:Bind ViewModel.ShowProfileEditDialogCommand}" HorizontalAlignment="Center" VerticalAlignment="Center" Width="39" Height="36" Margin="0,12,0,12">
                                            <Viewbox Width="14" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,2,0,0">
                                                <PathIcon Width="NaN" Height="NaN" Data="m13.94 5 5.061 5.06-.962.962a6.5 6.5 0 0 0-7.016 7.016l-1.96 1.96a2.25 2.25 0 0 1-1 .58l-5.115 1.395a.75.75 0 0 1-.92-.92l1.394-5.116a2.25 2.25 0 0 1 .58-1L13.94 5Zm7.091-2.03a3.579 3.579 0 0 1 0 5.06l-.97.97L15 3.94l.97-.97a3.578 3.578 0 0 1 5.061 0ZM14.28 13.974a2 2 0 0 1-1.441 2.497l-.584.144a5.729 5.729 0 0 0 .006 1.807l.54.13a2 2 0 0 1 1.45 2.51l-.187.632c.44.386.94.699 1.484.921l.494-.518a2 2 0 0 1 2.899 0l.498.525a5.28 5.28 0 0 0 1.483-.913l-.198-.686a2 2 0 0 1 1.442-2.496l.583-.144a5.729 5.729 0 0 0-.006-1.808l-.54-.13a2 2 0 0 1-1.45-2.51l.187-.63a5.28 5.28 0 0 0-1.484-.923l-.493.519a2 2 0 0 1-2.9 0l-.498-.525c-.544.22-1.044.53-1.483.912l.198.686ZM17.501 19c-.8 0-1.45-.672-1.45-1.5 0-.829.65-1.5 1.45-1.5.8 0 1.45.671 1.45 1.5 0 .828-.65 1.5-1.45 1.5Z"></PathIcon>
                                            </Viewbox>
                                        </Button>

                                        <Button Command="{x:Bind ViewModel.ShowProfileRemoveNoneDialogCommand}" HorizontalAlignment="Center" VerticalAlignment="Center" Width="39" Height="36" Margin="0,12,0,12">
                                            <Viewbox Width="14" Height="14" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,2,0,0">
                                                <PathIcon Width="NaN" Height="NaN" Data="M12 2c5.523 0 10 4.477 10 10s-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2Zm-4.25 9.25a.75.75 0 0 0-.102 1.493l.102.007h8.5a.75.75 0 0 0 .102-1.493l-.102-.007h-8.5Z"></PathIcon>
                                            </Viewbox>
                                        </Button>

                                    </StackPanel>

                                    <StackPanel Grid.Column="1" Spacing="12" Orientation="Horizontal" HorizontalAlignment="Right">
                                        <Button MinWidth="84" Width="150" Height="36" x:Uid="Settings_MPD_Reconnect" Command="{x:Bind ViewModel.ReConnectWithSelectedProfileCommand}" IsEnabled="{x:Bind ViewModel.IsConnectButtonEnabled,Mode=OneWay}" HorizontalAlignment="Center" VerticalAlignment="Center"></Button>
                                    </StackPanel>

                                </Grid>

                            </controls:SettingsCard>

                            <controls:SettingsCard Header="" Description="" HorizontalContentAlignment="Left" ContentAlignment="Vertical">
                                <CheckBox x:Uid="Settings_MPD_Opts_UpdateDatabaseOnStartup" IsChecked="{x:Bind ViewModel.IsUpdateOnStartup, Mode=TwoWay}" Margin="0,12,0,12"/>
                            </controls:SettingsCard>

                            <controls:SettingsCard Header="" Description="" HorizontalContentAlignment="Left" ContentAlignment="Vertical">
                                <CheckBox x:Uid="Settings_MPD_Opts_UseReadPicture" IsChecked="{x:Bind ViewModel.IsDownloadAlbumArtEmbeddedUsingReadPicture, Mode=TwoWay}" Margin="0,12,0,12"/>
                            </controls:SettingsCard>
                            
                        </controls:SettingsExpander.Items>

                    </controls:SettingsExpander>

                    <!-- Options -->
                    <controls:SettingsExpander x:Name="SettingsCardOptions"
                            VerticalAlignment="Top"
                            x:Uid="Settings_Options"
                            IsEnabled="True"
                            IsExpanded="False">
                        <controls:SettingsExpander.Items>
                            <controls:SettingsCard Header="" Description="" HorizontalContentAlignment="Left" ContentAlignment="Vertical">
                                <CheckBox x:Uid="Settings_Opts_AutoScrollToNowPlaying" IsChecked="{x:Bind ViewModel.IsAutoScrollToNowPlaying, Mode=TwoWay}" Margin="0,12,0,12"/>
                            </controls:SettingsCard>

                        </controls:SettingsExpander.Items>
                    </controls:SettingsExpander>

                    <!-- Local storage usage -->
                    <controls:SettingsExpander x:Name="SettingsCardLocalStorage"
                            VerticalAlignment="Top"
                            x:Uid="Settings_LocalStorage"
                            IsEnabled="True"
                            IsExpanded="False">
                        <controls:SettingsExpander.Items>

                            <controls:SettingsCard Header="" Description="" HorizontalContentAlignment="Stretch" ContentAlignment="Vertical">
                                <Grid Margin="0,12,0,12">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"></ColumnDefinition>
                                        <ColumnDefinition Width="*"></ColumnDefinition>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Orientation="Horizontal" Grid.Column="0" HorizontalAlignment="Stretch">
                                        <HyperlinkButton NavigateUri="{x:Bind ViewModel.AlbumCacheFolderPath, Mode=OneTime}" Content="{x:Bind ViewModel.AlbumCacheFolderPath, Mode=OneWay}" Click="HyperlinkButton_AlbumCacheFolderPath_Click" Margin="0,0,24,0"></HyperlinkButton>
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                                        <TextBlock Text="{x:Bind ViewModel.AlbumCacheFolderSizeFormatted, Mode=OneWay}" VerticalAlignment="Center" MinWidth="84"></TextBlock>
                                        <Button Content="Clear" Command="{x:Bind ViewModel.ClearAlbumCacheFolderCommand}" VerticalAlignment="Center" HorizontalAlignment="Right"></Button>
                                    </StackPanel>
                                </Grid>
                            </controls:SettingsCard>

                        </controls:SettingsExpander.Items>
                    </controls:SettingsExpander>

                    <!-- Project info -->
                    <controls:SettingsExpander x:Uid="Settings_ProjectPage">
                        <controls:SettingsExpander.Items>
                            <controls:SettingsCard Header="Project Page" HorizontalContentAlignment="Stretch" ContentAlignment="Vertical" Description="@Github">
                                <HyperlinkButton NavigateUri="https://github.com/torum/MPDCtrl/">https://github.com/torum/MPDCtrl/</HyperlinkButton>
                            </controls:SettingsCard>
                            <controls:SettingsCard Header="App Page" HorizontalContentAlignment="Stretch" ContentAlignment="Vertical" Description="@Github">
                                <HyperlinkButton NavigateUri="https://torum.github.io/MPDCtrl/">https://torum.github.io/MPDCtrl/</HyperlinkButton>
                            </controls:SettingsCard>
                            <controls:SettingsCard Header="Microsoft App Store Page" HorizontalContentAlignment="Stretch" ContentAlignment="Vertical" Description="@Microsoft">
                                <HyperlinkButton NavigateUri="https://apps.microsoft.com/detail/9nv2bbj82brx">https://apps.microsoft.com/detail/9nv2bbj82brx</HyperlinkButton>
                            </controls:SettingsCard>
                        </controls:SettingsExpander.Items>
                    </controls:SettingsExpander>

                    <!-- License -->
                    <controls:SettingsExpander x:Uid="Settings_License">

                        <controls:SettingsExpander.Items>
                            <controls:SettingsCard Header="The MIT License" HorizontalContentAlignment="Stretch" ContentAlignment="Vertical" Description="Copyright (c) 2018~ torum">
                                <TextBlock x:Uid="Settings_LicenseText" TextWrapping="Wrap" Margin="0,12,0,12"></TextBlock>
                            </controls:SettingsCard>
                        </controls:SettingsExpander.Items>

                    </controls:SettingsExpander>
                    
                    <!-- PrivacyPolicy -->
                    <controls:SettingsExpander x:Uid="Settings_PrivacyPolicy">

                        <controls:SettingsExpander.Items>
                            <controls:SettingsCard Header="" HorizontalContentAlignment="Stretch" ContentAlignment="Vertical" Description="">
                                <TextBlock  x:Uid="Settings_PrivacyPolicyText" TextWrapping="Wrap" Margin="0,12,0,12"></TextBlock>
                            </controls:SettingsCard>
                        </controls:SettingsExpander.Items>
                        
                    </controls:SettingsExpander>

                    <!-- Third party -->
                    <controls:SettingsExpander Header="Third-Party Dependency &amp; Libraries" Description="Built with C#/.NET">

                        <controls:SettingsExpander.Items>
                            <controls:SettingsCard Header="Microsoft" HorizontalContentAlignment="Stretch" ContentAlignment="Vertical" Description="The MIT License">
                                <StackPanel Spacing="12" Margin="0,12,0,12">
                                    <HyperlinkButton NavigateUri="https://github.com/CommunityToolkit/Windows">CommunityToolkit.Mvvm/WinUI</HyperlinkButton>
                                    <HyperlinkButton NavigateUri="https://www.nuget.org/packages/microsoft.extensions.dependencyinjection/">Microsoft.Extensions.DependencyInjection</HyperlinkButton>
                                    <HyperlinkButton NavigateUri="https://www.nuget.org/packages/Microsoft.Extensions.Hosting">Microsoft.Extensions.Hosting</HyperlinkButton>
                                    <HyperlinkButton NavigateUri="https://www.nuget.org/packages/System.Security.Cryptography.ProtectedData/">System.Security.Cryptography.ProtectedData</HyperlinkButton>
                                    <HyperlinkButton NavigateUri="https://github.com/microsoft/WindowsAppSDK">WindowsAppSDK</HyperlinkButton>
                                    <HyperlinkButton NavigateUri="https://github.com/microsoft/microsoft-ui-xaml">WinUI3</HyperlinkButton>
                                </StackPanel>
                            </controls:SettingsCard>
                        </controls:SettingsExpander.Items>

                    </controls:SettingsExpander>

                </StackPanel>
            </ScrollViewer>
        </Grid>

        <VisualStateManager.VisualStateGroups>
            <VisualStateGroup>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="1008" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HeaderGrid.Margin" Value="48,0,48,0" />
                        <Setter Target="BodyGrid.Margin" Value="48,0,48,0" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="640" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HeaderGrid.Margin" Value="24,0,24,0" />
                        <Setter Target="BodyGrid.Margin" Value="24,0,24,0" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="340" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HeaderGrid.Margin" Value="16,0,16,0" />
                        <Setter Target="BodyGrid.Margin" Value="16,0,16,0" />
                    </VisualState.Setters>
                </VisualState>
                <VisualState>
                    <VisualState.StateTriggers>
                        <AdaptiveTrigger MinWindowWidth="0" />
                    </VisualState.StateTriggers>
                    <VisualState.Setters>
                        <Setter Target="HeaderGrid.Margin" Value="16,0,16,0" />
                        <Setter Target="BodyGrid.Margin" Value="16,0,16,0" />
                    </VisualState.Setters>
                </VisualState>
            </VisualStateGroup>
        </VisualStateManager.VisualStateGroups>
    </Grid>
</Page>
